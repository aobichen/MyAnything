
<style type="text/css">
    .deleteicon {
        left: 84%;
        top: -2px;
        z-index: 100;
        position: absolute;
    }

    .imagefile {
        padding-top: 5px;
    }
</style>
<div id="ImageUploadDiv">
    <input type="file" name="files[]" id="fileupload" multiple />
    <div id="imagePanel">
        <div class="col-md-2 imagefile" id="ImageThumbnail" style="display:none">
            <div class="thumbnail">
                <img class="img-responsive" />

            </div>
            <i class="glyphicon glyphicon-remove-circle deleteicon"></i>
        </div>

        @{
            if (ViewBag.RoomImg != null)
            {
                foreach (var item in (List<Anything.Models.RoomImage>)ViewBag.RoomImg)
                {
                    <div class="col-md-2 imagefile">
                        <div class="thumbnail">
                            <img class="img-responsive" src="@item.Path" />

                        </div>
                        <i id="@item.Name" class="glyphicon glyphicon-remove-circle deleteicon"></i>
                    </div>
                }
            }
        }

    </div>
    <input type="hidden" name="imagekey" id="sessionkey" value="@ViewBag.SessionKey" />
</div>
<script type="text/javascript">
    jQuery(function(){
        var ImageUploadDiv = $("#ImageUploadDiv");
        var fileUpload = ImageUploadDiv.find("#fileupload");

        fileUpload.on("change", function (e)
            {
                if (!e.target.files) return;
                var files = e.target.files;
                var formData = new FormData();

                if (files.length > 0)
                    {
                        for (var i = 0, max = files.length; i < max; i++)
                        {
                            formData.append("files"+i, files[i]);
                        }
                        formData.append("key",$('#sessionkey').val());
                                $.ajax({
                                    type: "POST",
                                    url: '/RoomImageUpload',
                                    data: formData,
                                    contentType: false,
                                    processData: false,
                                    success: function (xhr)
                                        {
                                            let d = JSON.parse(xhr.data);
                            
                                            var div = $('#imagePanel');
                                            for (let i = 0, max = d.length; i < max; i++)
                                            {                               
                                                if ($(".deleteicon[id=" + d[i].Name + "]").length <= 0) {
                                                    let temp = $("#ImageThumbnail").clone(true);
                                                    temp.css({ "display": "block" });
                                                    temp.find("img").attr("src", d[i].Path);
                                                    temp.find(".deleteicon").attr("id", d[i].Name);
                                                   div.append(temp);
                                                }
                                            }

                                            fileUpload.val('');
                                        },
                                    error: function (xhr)
                                        {
                                            console.log("ERROR");
                                        }
                                });
                    }
                    e.stopPropagation();
            });

                $(".deleteicon").on("click", function ()
                {
                        var self = $(this);
                        var selfid = $(this).attr("id");
                        $.ajax({
                            type: "POST",
                            url: '/RoomImageDelete',          
                            data: { name: selfid, key: $('#sessionkey').val() },        
                            dataType: "json",
                            cache:false,
           
                            success: function (xhr) {
                                if (xhr.success == true) {

                                    self.closest('.imagefile').remove();
                                }
                            },
                            error: function (xhr) {
                                console.log("ERROR");
                            }
                        });
                });

    })
</script>

