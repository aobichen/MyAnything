@model Anything.Models.Hotel

@{
    ViewBag.Title = "Detail";
}


<style type="text/css">
    .carousel-indicators img{
        width:100px;
        height:100px;
        bottom:0;
        right:0;
        position:absolute;
        z-index:10;
    }
    td > *{
        vertical-align:middle;
    }
</style>

<div>
    <h2>@Model.Name</h2>
    <hr />
    <div class="row">
        <input type="hidden" id="sessionkey" value="@ViewBag.SessionKey" />
        <div class="col-md-3"></div>
        <div class="col-md-10">
            <div class="col-md-12">
                <div id="carousel-hotel" class="carousel slide" data-ride="carousel">
                   
                    <div class="carousel-inner" role="listbox">
                        @if (Model.HotelImage != null) { 
                        for (var i = 0; i < Model.HotelImage.Count; i++)
                           {
                               var item = Model.HotelImage.ToList()[i];
                               if (item.Sort <= 1)
                                {
                                    <div class="item active">
                                        <img class="img-responsive hotel-image" data-id="@i" src="@Url.Action("Image", "Hotel", new {id=item.ID })" alt="@Model.Feature">
                                       
                                    </div>
                                }
                                else
                                {
                                    <div class="item">
                                        <img class="img-responsive hotel-image" data-id="@i" src="@Url.Action("Image", "Hotel", new {id=item.ID })" alt="@Model.Introduce">

                                    </div>

                                }
                           }
                        }
                    </div>

                    <!-- Controls -->
                    <a class="left carousel-control" href="#carousel-hotel" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#carousel-hotel" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
           
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body small-hotel-image">
                        @for (var i = 0; i < Model.HotelImage.Count; i++)
                        {
                            if (i == 0)
                            {
                                <div class="col-md-1 col-sm-2 col-xs-2 col-lg-2 thumbnail active" data-id="@i">
                                    <img class="img-responsive small-img" data-id="@i" src="@Url.Action("Image", "Hotel", new { id = Model.HotelImage.ToList()[i].ID })" alt="@Model.Name" />
                                </div>
                            }
                            else
                            {
                                <div class="col-md-1 col-sm-2 col-xs-2 col-lg-2 thumbnail" data-id="@i">
                                    <img class="img-responsive small-img" data-id="@i" src="@Url.Action("Image", "Hotel", new { id = Model.HotelImage.ToList()[i].ID })" alt="@Model.Name" />
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <!-- Room List -->
            <div class="col-md-12">
                @if (Model.Room != null && Model.Room.Count > 0) { 
                    <table class="table table-room">
                        @foreach (var item in Model.Room)
                        {
                            <tr>
                                <td class="col-md-2 col-sm-2 col-xs-2 col-lg-2">
                                    <div>
                                        @if (item.RoomImage != null && item.RoomImage.Count > 0)
                                        {
                                            <div class="thumbnail">
                                                <img class="img-responsive" src="@Url.Action("Image", "Room", new {id = item.RoomImage.ToList()[0].ID })" />
                                            </div>
                                        }
                                    </div>

                                </td>

                                <td class="col-md-10 form-group" style="vertical-align:middle;">
                                    <div class="col-md-8 col-sm-6 ">
                                        <!-- Room Detail-->
                                        <span data-id="@item.ID" class="form-control item-name">
                                            @item.Name
                                        </span>

                                        <!-- Modal Detail Content-->
                                        <div class="item-detail hidden col-md-12">
                                            <div class="container row col-md-12">

                                                @if (item.RoomImage != null && item.RoomImage.Count > 0)
                                                {
                                                    <div class="col-md-12">
                                                        <div class="thumbnail">
                                                            <img class="img-responsive lg-img" src="@Url.Action("Image","Room",new {id=item.RoomImage.ToList()[0].ID})" />
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">

                                                        @foreach (var roomimg in item.RoomImage)
                                                            {
                                                                <div class="col-md-2 col-sm-2 col-xs-2 col-lg-2 thumbnail">
                                                                    <img class="img-responsive xs-img" src="@Url.Action("Image","Room",new {id=roomimg.ID})" />
                                                                </div>
                                                            }


                                                    </div>
                                                }

                                            </div>
                                            <div class="col-md-12 item-information">
                                                @Html.Raw(item.Information)
                                            </div>
                                        </div>


                                    </div>
                                    <div class="col-md-4 form-group">
                                        <div class="col-md-6 col-sm-3 col-xs-4">
                                            @*<label>@item.Amount</label>*@
                                            @if (item.Amount <= 0)
                                            {
                                                <span>
                                                    客滿
                                                </span>
                                            }
                                            else
                                            {
                                                <select class="form-control AmountSelect" id="@item.ID" >
                                                    @for (var i = 0; i < item.Amount; i++)
                                                    {
                                                        var amount = i + 1;
                                                        <option value="@amount">@amount</option>
                                                    }
                                                </select>
                                            }
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-8">
                                            @if (item.Amount <= 0)
                                            {
                                                <button type="button" class="btn btn-warning">
                                                    無空房
                                                </button>
                                            }
                                            else { 
                                            <a class="btn btn-primary" href="@Url.Action("Create", "Order", new { id = item.ID, key = ViewBag.SessionKey })">
                                                訂房
                                            </a>
                                            }
                                            </div>
                                        </div>
                                    
                                </td>
                            </tr>
                        }
                    </table>
                }
                else
                {
                    <div class="alert alert-danger">
                        目前已無空房
                    </div>
                }
            </div>
        </div>
        
    </div>
    
</div>


<!-- Modal -->
<div class="modal fade" id="DetailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
               
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    jQuery(function () {
        $('#carousel-hotel').on('slide.bs.carousel', function () {

            var self = $(this);
            var Max = $('.hotel-image').length;
            var id = self.find(".active > img").attr("data-id");
            var NextId = parseInt(id) + 1;
            if (NextId >= Max) {
                NextId = 0;
            }
            var NextImage = $('.thumbnail[data-id=' + NextId + ']');
            if (NextImage.length > 0) {
                $('.thumbnail').removeClass("active");
                NextImage.addClass("active");
            }
        });

        $(".small-img").on("click", function (e) {
            let self = $(this);
            var index = parseInt(self.attr('data-id'));
            
            $('#carousel-hotel').carousel(index);
            $('.thumbnail').removeClass("active");
            self.parent('.thumbnail').addClass("active");
        });

        $('.item-name').on('click', function (e) {
            var self = $(this);
            var detail = self.siblings('.item-detail').clone(true).removeClass("hidden");
            var ModalBody = $('#DetailModal .modal-body');
            ModalBody.html(detail.html());
            var ModalTitle = $('#DetailModal .modal-title');
            ModalTitle.text(self.closest('.item-name').text());
            $('#DetailModal').modal('show');
        });

        $('.modal-body').delegate(".xs-img", 'click', function () {
            $('.lg-img', '.modal-body').attr('src',$(this).attr('src'));
        });

        $('.AmountSelect').on("change", function () {
            var self = $(this);
            var selected = $(this).val();
            var id = $(this).attr('id');
            $.ajax({
                type: "POST",
                url: '@Url.Action("SetSelectedAmount","Order")',
                data: { roomid: id, key: $('#sessionkey').val(),amount : selected },
                dataType: "json",
                cache: false,

                success: function (xhr) {
                    
                },
                error: function (xhr) {
                    console.log("ERROR");
                }
            });
        });
    });
</script>